<html>
  <head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      .legend span {
        margin-right: 10px;
      }
        
      .gridlines line {
        stroke: #bbb;
      }
      
      .gridlines .domain {
        stroke: none;
      }
    </style>
  </head>
  <body>
    <h3>Charlotte Verity (cev32)</h3>
      <svg id="graph1" height="500" width="800" style="background: white;">
      </svg>
      <script>
        d3.csv('data.csv', d3.autoType).then( (data) => { 
        const svg = d3.select('svg#graph1');
        const width = svg.attr('width');
        const height = svg.attr('height');
        const margins = {top: 30, right: 10, bottom: 50, left: 100};
        const chartWidth = width - margins.left - margins.right;
        const chartHeight = height - margins.top - margins.bottom;
        
        let chartArea = svg.append('g')
                           .attr('transform',`translate(${margins.left},${margins.top})`);
        data = data.filter( d => d.Danceability != null)
        data = data.filter( d => d.Valence != null)
        data = data.filter( d => d.Views != null)
        data = data.filter( d => d.Likes != null)
        data = data.filter( d => d.Stream != null)
       // data = data.filter( d => d.Stream >= 1000000000)

        const valenceExtent = d3.extent(data, d => d['Valence'] );
        const valenceScale = d3.scaleLinear().domain(valenceExtent).range([chartHeight, 0]);
        
        const danceabilityExtent = d3.extent(data, d => d['Danceability'] );
        const danceabilityScale = d3.scaleLinear().domain(danceabilityExtent)
                            .range([0, chartWidth]);

        const viewsExtent = d3.extent(data, d => d['Views'] );
        const viewsScale = d3.scaleLinear().domain(viewsExtent)
                            .range([0, 10]);



        let leftAxis = d3.axisLeft(valenceScale); 
        svg.append('g')
          .attr('class', 'y axis')
          .attr('transform',`translate(${margins.left-10},${margins.top})`) 
          .call(leftAxis);
        let bottomAxis = d3.axisBottom(danceabilityScale).ticks(6)
        svg.append('g')
          .attr('class', 'y axis')
          .attr('transform',`translate(${margins.left},${chartHeight+margins.top+10})`)
          .call(bottomAxis);
        let leftGridlines = d3.axisLeft(valenceScale)
          .tickSize(-chartWidth-10)
          .tickFormat('');
        svg.append('g')
          .attr('class', 'y gridlines')
          .attr('transform',`translate(${margins.left-10},${margins.top})`)
          .lower()
          .call(leftGridlines);        
        let bottomGridlines = d3.axisBottom(danceabilityScale)
          .tickSize(-chartHeight-10)
          .tickFormat('')
          .ticks(6);
        svg.append('g')
          .attr('class', 'x gridlines')
          .attr('transform',`translate(${margins.left},${chartHeight+margins.top+10})`)
          .lower()
          .call(bottomGridlines);

        svg.append("text")
          .attr("class", "title")
          .attr("text-anchor", "end")
          .attr("x", width/2+300)
          .attr("y", 15)
          .attr("font-family", "Arial")
          .text("Visualizing Song Valence vs. Danceability with Size Proportional to Popularity");

        svg.append("text")
          .attr("class", "x label")
          .attr("text-anchor", "end")
          .attr("x", width/2+80)
          .attr("y", height-4)
          .attr("font-family", "Arial")
          .text("Danceability");
          
        data.forEach( (d, i) => {
          chartArea.append('circle')
              .attr('cx', danceabilityScale(d['Danceability']))
              .attr('cy', valenceScale(d['Valence']))
              .attr('r', viewsScale(d['Views']))
              .attr('rad', viewsScale(d['Views']))
              .attr('class', d['Track'])
              .attr('opacity', .8)
              .attr('index', i)
              .style('fill', 'red')
              .on('mouseover', function (d, i) {
                d3.select(this).transition()
                    .duration('50')
                    .style('fill', 'blue')
                chartArea.append("text")
                  .attr("x",10)
                  .attr("y",20)
                  .style("font-size","15px")
                  .text(d3.select(this).attr("class"));
              })
              .on('mouseout', function (d, i) {
                d3.select(this).transition()
                  .duration('50')
                  .style('fill', 'red')
                chartArea.selectAll("text")
                  .remove()
              });

        });
        }, (error) => { console.log(error)} );
      </script>
      <br>
      <br>
      <br>
      <svg id="graph2" height="500" width="800" style="background: white;">
      </svg>
      <script>
        d3.csv('data.csv', d3.autoType).then( (data) => { 
        const svg = d3.select('svg#graph2');
        const width = svg.attr('width');
        const height = svg.attr('height');
        const margins = {top: 30, right: 20, bottom: 50, left: 100};
        const chartWidth = width - margins.left - margins.right;
        const chartHeight = height - margins.top - margins.bottom;
        
        let chartArea = svg.append('g')
                           .attr('transform',`translate(${margins.left},${margins.top})`);
        data = data.filter( d => d.Danceability != null)
        data = data.filter( d => d.Valence != null)
        data = data.filter( d => d.Views != null)
        data = data.filter( d => d.Likes != null)
        data = data.filter( d => d.Stream != null)

        const streamExtent = d3.extent(data, d => d['Stream'] );
        const streamScale = d3.scaleLinear().domain(streamExtent).range([chartHeight, 0]);
        
        const viewsExtent = d3.extent(data, d => d['Views'] );
        const viewsScale = d3.scaleLinear().domain(viewsExtent)
                            .range([0, chartWidth]);

        const durationExtent = d3.extent(data, d => d['Duration_ms'] );
        const durationScale = d3.scaleLinear().domain(durationExtent)
                            .range([0, 10]);

        console.log(durationExtent)
        console.log(streamExtent)
        console.log(viewsExtent)
        

        let leftAxis = d3.axisLeft(streamScale); 
        svg.append('g')
          .attr('class', 'y axis')
          .attr('transform',`translate(${margins.left-10},${margins.top})`) 
          .call(leftAxis);
        let bottomAxis = d3.axisBottom(viewsScale).ticks(6)
        svg.append('g')
          .attr('class', 'y axis')
          .attr('transform',`translate(${margins.left},${chartHeight+margins.top+10})`)
          .call(bottomAxis);
        let leftGridlines = d3.axisLeft(streamScale)
          .tickSize(-chartWidth-10)
          .tickFormat('');
        svg.append('g')
          .attr('class', 'y gridlines')
          .attr('transform',`translate(${margins.left-10},${margins.top})`)
          .lower()
          .call(leftGridlines);        
        let bottomGridlines = d3.axisBottom(viewsScale)
          .tickSize(-chartHeight-10)
          .tickFormat('')
          .ticks(6);
        svg.append('g')
          .attr('class', 'x gridlines')
          .attr('transform',`translate(${margins.left},${chartHeight+margins.top+10})`)
          .lower()
          .call(bottomGridlines);

        svg.append("text")
          .attr("class", "title")
          .attr("text-anchor", "end")
          .attr("x", width/2+300)
          .attr("y", 15)
          .attr("font-family", "Arial")
          .text("Visualizing Youtube Views vs. Spotify Streams with Size Proportional to Duration");

        svg.append("text")
          .attr("class", "x label")
          .attr("text-anchor", "end")
          .attr("x", width/2+80)
          .attr("y", height-4)
          .attr("font-family", "Arial")
          .text("Views");
          
        data.forEach( (d, i) => {
          chartArea.append('circle')
              .attr('cx', viewsScale(d['Views']))
              .attr('cy', streamScale(d['Stream']))
              .attr('r', durationScale(d['Duration_ms']))
              .attr('class', d['Track'])
              .attr('opacity', .8)
              .attr('index', i)
              .style('fill', 'green')
              .on('mouseover', function (d, i) {
                d3.select(this).transition()
                    .duration('50')
                    .style('fill', 'blue')
                chartArea.append("text")
                  .attr("x",10)
                  .attr("y",20)
                  .style("font-size","15px")
                  .text(d3.select(this).attr("class"));
              })
              .on('mouseout', function (d, i) {
                d3.select(this).transition()
                  .duration('50')
                  .style('fill', 'green')
                chartArea.selectAll("text")
                  .remove()
              });

        });
        }, (error) => { console.log(error)} );
      </script>
  </body>
</html>